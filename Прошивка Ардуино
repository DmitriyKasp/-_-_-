#include <Servo.h>

const int trigPin=12;
const int echoPin=11;

long duration;
int distance;

Servo s1;

void setup(){
  Serial.begin(9600);
  pinMode(trigPin,OUTPUT);
  pinMode(echoPin,INPUT);

  s1.attach(10);
}

void loop(){
    for(int i=15;i<=165;i++){ //вращаем серводвигатель от 15 до 165 градусов
      s1.write(i);
      delay(30);
      distance = calDist();
  
      Serial.print(i);                      // Отправляем градусы в порт
      Serial.print(","); // Разделяем данные для processing программы
      Serial.print(distance);               // Отправляем расстояние в порт
      Serial.print("."); // Разделяем данные для processing программы
    }

    for(int i=165;i>15;i--){   // Тоже самое в обратном направлении
      s1.write(i);
      delay(30);
      distance = calDist();
      Serial.print(i);
      Serial.print(",");
      Serial.print(distance);
      Serial.print(".");
    }
}

int calDist(){
   digitalWrite(trigPin, LOW);
   delayMicroseconds(2);
                            // Отправляем сигнал с датчика расстония 
   digitalWrite(trigPin, HIGH);
   delayMicroseconds(10);
   digitalWrite(trigPin, LOW); 
                                        // Считываем показания датчика
   duration = pulseIn(echoPin, HIGH);
                                        // Рассчитываем сантиметры
   distance = duration*0.034/2;

   return distance;
}
